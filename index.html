<!doctype html>
<html>
<head>
	<title>API Fun</title>
	<meta charset="utf-8"/>
	<link href="https://fonts.googleapis.com/css2?family=Fredericka+the+Great&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="beerQuiz.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
	<!-- <Files “*.json”> Header set Access-Control-Allow-Origin “*” </Files>  -->
	<script>

		/* Global Variables */
		var username;
		var currQuestion;
		var score;

		var currBeersJSON;
		var likedBeersJSON = [];

		var qType;
		var answer;

		var currQuestionHTML;


		//Set a question up the reqs two beers
		function setTwoBeers(input) {

			request = new XMLHttpRequest();
			console.log("1 - request object created");
 
			var url = "https://api.punkapi.com/v2/beers?ids=" + input;

			// input is of the form:
			// "1|56|7|4"
 
			request.open("GET", url, true)
			console.log("2 - opened request file");
 
			// Step 3: set up event handler/callback

			request.onreadystatechange = function() {
				console.log("3 - readystatechange event fired.");
 
				if (request.readyState == 4 && request.status == 200) {

					// Step 5: wait for done + success
					console.log("5 - response received");

					result = request.responseText;
					data = JSON.parse(result);

					currBeersJSON = data;

					setQuestion();

					
				}
				else if (request.readyState == 4 && request.status != 200) {

					document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";

				}

				else if (request.readyState == 3) {

					document.getElementById("data").innerHTML = "Too soon!  Try again";

				}

			}
			request.send();
			console.log("4 - Request sent");
		}

		//uses Global varianle currBeersJSON
		//and the variable qType;
		function setQuestion() {
			//a = document.getElementById("data");

			answer = Math.floor((Math.random() * 2) + 1);
			answer--;
			//answer is an index of currBeersJSON


			//html is the Question to be displayed
			html = "";

			html += "<div class='container'>";

			// html += "The answer is " + currBeersJSON[answer]["name"] + "<br>";

			html += "<h2 id='beer-qn'>Which Beer Pairs Better with " + currBeersJSON[answer]["food_pairing"][0] 
			         + "?</h2><br>";

			// html += "<ul>"

			html += "<div class='item_left'>";
			html += "<li><button class='testbtn' onclick='likeBeer0()' id='btn0'>Like</button>";
			html += "<button class='answer-btn' onclick='testAnswer0()'>" + showBeerJSON(currBeersJSON[0]) + "</button></li><br><br><br><br><br><br><br><br>";
			html += "</div>";


			html += "<div class='item_right'>";
			html += "<li><button class='testbtn' onclick='likeBeer1()' id='btn1'>Like</button>";
			html += "<button class='answer-btn' onclick='testAnswer1()'>" + showBeerJSON(currBeersJSON[1]) + "</button></li><br><br><br><br><br><br><br><br>";
			html += "</div>";

			// html += "</ul>";

			html += "</div>";

			//sets the innerHTML of id data to be var html
			$("#data").html(html);


			//sets the value of buttons to match the name
			// pill shared buttonz
			$("#true").val(currBeersJSON[0]["name"]);
			$("#false").val(currBeersJSON[1]["name"]);

		}

		function showBeer(beer, a){

			//a.innerHTML = "";

			var html = "";

			html += "ID - " + beer["id"] + "<br>";

			html += "<h2>" + beer["name"] +"<h2>";
			html += "<br>";
			html += "<img src='" + beer["image_url"] + "' height=300 />";
			html += "<p>" + beer["description"] + "<p>";

			html += "tag line: " + beer["tagline"] + "<br>";
			html += "First Brewed: " + beer["first_brewed"] + "<br>";
			html += "abv - " + beer["abv"] + "<br>";
			html += "ibu - " + beer["ibu"] + "<br>";
			html += "ebc - " + beer["ebc"] + "<br>";
			html += "srm - " + beer["srm"] + "<br>";
			html += "ph - " + beer["ph"] + "<br>";
			html += "Attenuation Level: " + beer["attenuation_level"] + "<br>";

			html += "Volume: ";
			html += beer["volume"]["value"] + " " + beer["volume"]["unit"] + "<br>";


			html += "Boil Volume: ";
			html += beer["volume"]["value"] + " " + beer["volume"]["unit"] + "<br>";

			//method

			//ingrediants
				//malt
				//hops
				//yeast

			html += "Food Pairing: " + beer["food_pairing"][0] + "<br>";

			html += "Brewers Tips: " + beer["brewers_tips"] + "<br>";

			html += "<br><br><br>";



			a.innerHTML = html;
		}

		//TODO: add if statements what what to be shown
		//      depending on the question type
		function showBeerJSON(beer){

			output = "";

			//Add a button and set the onclick, worst case
			//put it in the form

			output += "<h2>" + beer["name"] +"<h2>";
			output += "<br>";
			output += "<img src='" + beer["image_url"] + "' height=300 />";
			output += "<p class='beer-desc'>" + beer["description"] + "<p>";
			// output += "ID - " + beer["id"] + "<br>";

			//if (qType != 1){
			// output += "Food Pairing" + beer["pairing"];
			//}

			return output;

		}

		function nextQuestion() {
			
			qType = 1;

			num1 = Math.floor((Math.random() * 187) + 1);
			num2 = Math.floor((Math.random() * 187) + 1);

			//add make sure theyre not the same

			twoBeers = num1 + "|" + num2;

			setTwoBeers(twoBeers);
		}

		// Functionality must be fixed
		function addCurrBeer() {

			insert(likedBeers, currBeerJSON["id"], currBeerJSON["name"]);
			likedBeersJSON.push(currBeerJSON);

		}

		//Not Used but can be kept
		function showArray(arr){
			var output = "";
			for(key in arr)
			{
    			output += arr[key].beer + " | ";         
			}
			return output;
		}

		//Not Used but can be
		function insert(arr, id, beer) {
    		arr.push({
        		id: id,
        		beer: beer
    		});        
		}


		function startSwiping(){ 

			username = document.getElementById("user").value;

			currQuestion = 1;
			score = 0;

			$("#currQuestion").html("1/25");
			$("#score").html("SCORE - 0");

			$("#username").html(username);


			beerID = 9;
			prevLiked = "9|5|7|8";
			numberLiked = prevLiked.length;
			numberLiked = (numberLiked/2) + .5;

			nextQuestion();

			var toShow = ["#liked", "form", "#data", "#currQuestion", "#score", "header", "#liked-form"];

			showJQuery(toShow);

			$("#messy").hide();
			$("#messy-v").hide();
			$("#intro").hide();
		}

		function showLiked(){

			currQuestionHTML = $('#data').html();

			$("#back").show();

			$("#liked").hide();
			$("#false").hide();
			$("#true").hide();

			a = document.getElementById("data");
			a.innerHTML = "";

			if(likedBeersJSON.length == 0){
				a.innerHTML += "<br><h2>No Liked Beers</h2>";
			}else{
				a.innerHTML += "<ul>";

				n = likedBeersJSON.length - 1;

				for(i = n; i > -1; i--)
				{
					a.innerHTML += "<li>" + showBeerJSON(likedBeersJSON[i]) + "</li>";
				}
				a.innerHTML += "</ul>";
				a.innerHTML += "<br><br><br>";
			}
		}

		function backToSwiping(){

			$("#liked").show();

			$("#back").hide();
			$('#data').html(currQuestionHTML);

		}

		function likeBeer0() {

			if(!likedBeersJSON.includes(currBeersJSON[0])){
				likedBeersJSON.push(currBeersJSON[0]);
			}

			$("#btn0").html("Liked");
		}

		function likeBeer1() {

			if(!likedBeersJSON.includes(currBeersJSON[1])){
				likedBeersJSON.push(currBeersJSON[1]);
			}

			$("#btn1").html("Liked");
		}

		function testAnswer0() {

			if(answer == 0){
				rightAnswer();
			}else{
				wrongAnswer();
			}
		}

		function testAnswer1() {

			if(answer == 1){
				rightAnswer();
			}else{
				wrongAnswer();
			}
		}


		function wrongAnswer() {

			if(currQuestion == 25){
				endQuiz();
			}else{
				currQuestion++;

				output = currQuestion + "/25";
				$("#currQuestion").html(output);
				nextQuestion();
			}
		}

		function rightAnswer() {

			score = score + 4;
			output = "SCORE - " + score;
			$("#score").html(output);


			if(currQuestion == 25){
				endQuiz();
			}else{
				currQuestion++;

				output = currQuestion + "/25";
				$("#currQuestion").html(output);
				nextQuestion();
			}

		}

		/* 
		 * Ends the Quiz By hiding all current elements on
		 * the page, and showing the final form.
		 * The final form, once submitted takes you too
		 * the server which acesses the Database
		 */
		function endQuiz() {

			var toHide = ["#back", "#false", "#true", "#liked", "form", "#data", "#currQuestion", "#score", "#login"];

			hideJQuery(toHide);

			var toShow = ["#FF1", "#FF2", "#final_form", "#final_submit", "#final_message"];

			showJQuery(toShow);


			$("#final_message").html(username + " - " + score);
			$("#final_user").val(username);
			$("#final_score").val(score);


			//Madeline Might have changed this Line

			var string_likedBeers = JSON.stringify(currBeersJSON);

			$("#final_likedBeers").val(string_likedBeers);



			//This Line Might need to be changed
		}

		function showJQuery(arr) {
			for(i = 0; i < arr.length; i++){

				$(arr[i]).show();

			}
		}

		function hideJQuery(arr) {
			for(i = 0; i < arr.length; i++){

				$(arr[i]).hide();

			}
		}


		//
		window.onload = function() {


			var toHide = ["#back", "#false", "#true", "#liked", "form", "#data", "#FF1", "#FF2", "#final_form", "#final_user", "#final_score", "#final_likedBeers", "#final_submit", "#currQuestion", "#score", "#final_message", "header", "#liked-form"];

			hideJQuery(toHide);

			$("#login").show();


			// Pill Shaped Buttons
			$("#true").click(testAnswer0);
			$("#false").click(testAnswer1);
			// Pill Shaped Buttons

			$("#liked").click(showLiked);
			$("#back").click(backToSwiping);
			$("#sign_in").click(startSwiping);

		}

	</script>
</head>

<body>

	<header id="header">
		<div id="score-parent">
			<div id="currQuestion"></div>
			<div id="score"></div>
		</div>
		<div id="username">&nbsp;</div>
		<h1>The Impossible Brew Quiz</h1>
	</header>

	<!-- Login Form -->
	<div id="messy">
		<div class="conainter" id="messy-v">

			<div class="item_left" id="login_left">
				<h1 id="intro_title">The Impossible Brew Quiz</h1>
				<h2 id="intro">Welcome all beer enthusiasts! <br>Think you know beers better than your friends? Try the Impossible Brew Quiz! Featuring the most diabolical beer trivia, it's the ultimate beer test!</h2>

			</div>
			<div class="item_right" id="login_right">
				<form id="login">
					<span id="enter-pls">Enter your username to start!</span><br/>
					<input type="text" value="" id="user">
	
					<input type="button" id="sign_in" value="Start">
				</form>
			</div>

		</div>
	</div>
	<!-- End Login Form -->


	<div id="liked-form">
			<!-- <div id="currQuestion"></div>
			<div id="score"></div> -->
			<!-- <br> -->
			<input type="button" id="liked" value="See Liked Recipies">
			<input type="button" id="back" value="Back to Swiping">
	</div>
	

	<div id="data">Loading...</div>


	<!-- Final Form -->
	<div id="FF1">
		<div id="FF2">
			<form id="final_form" method = "GET" action = "http://localhost:8080">
				<p id="final_message"></p>

				<input id="final_user" name="final_user" value="_____">
				<input id="final_score" name="final_score" value="_____">
				<input id="final_likedBeers" name="final_likedBeers" value="_____">

				<input type="submit" id="final_submit" value="Save & See Ranking">
			</form>
		</div>
	</div>
	<!-- End Final Form -->


	<footer id="footer">

		<input type="button" id="true" value="T">
		<input type="button" id="false" value="F">
		<div id="likedBeersArr">SPAM Inc.</div>
	<footer>

</body>
</html>

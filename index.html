<!doctype html>
<html>
<head>
	<title>API Fun</title>
	<meta charset="utf-8"/>
	<link rel="stylesheet" type="text/css" href="BrewBuddies.css">
	<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
	<!-- <Files “*.json”> Header set Access-Control-Allow-Origin “*” </Files>  -->
	<script>

		//Global Variables
		var username;
		var beerID;
		var currBeer;
		var currBeerJSON;
		var likedBeers = [];

		//Requests and Gets the API
		//Sends the JSON file to be sorted
		function getData(num) {

			/* Step 1: Make instance of request object...
			...to make HTTP request after page is loaded*/
			request = new XMLHttpRequest();
			console.log("1 - request object created");
 
			// Step 2: Set the URL for the AJAX request to be the JSON file

			var url = "https://api.punkapi.com/v2/beers/" + beerID.toString();
 
			request.open("GET", url, true)
			console.log("2 - opened request file");
 
			// Step 3: set up event handler/callback

			request.onreadystatechange = function() {
				console.log("3 - readystatechange event fired.");
 
				if (request.readyState == 4 && request.status == 200) {

					// Step 5: wait for done + success
					console.log("5 - response received");

					result = request.responseText;
					currBeer = result;

					data = JSON.parse(result);
					currBeerJSON = data;

					showFullJson();

					
				}
				else if (request.readyState == 4 && request.status != 200) {

					document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";

				}

				else if (request.readyState == 3) {

					document.getElementById("data").innerHTML = "Too soon!  Try again";

				}

			}
		// Step 4: fire off the HTTP request
			request.send();
			console.log("4 - Request sent");
		}

		function showFullJson() {
			a = document.getElementById("data");
			showBeer(currBeerJSON[0], a);
		}

		function showBeer(beer, a){

			//a.innerHTML = currBeer;

			a.innerHTML = "";

			a.innerHTML += "<h2>" + beer["name"] +"<h2>";
			a.innerHTML += "<br>";
			a.innerHTML += "<img src='" + beer["image_url"] + "' height=300 />";
			a.innerHTML += "<p>" + beer["description"] + "<p>";

			//a.innerHTML += "<h2>" + beer["id"] +"<h2>";
		}

		function nextBeer() {
			//alert("show next beer");
			beerID++;
			getData();
		}

		function addCurrBeer() {

			//likedBeers.push(currBeerJSON[0]["name"]);
			insert(likedBeers, currBeerJSON[0]["id"], currBeerJSON[0]["name"]);
			f = document.getElementById("footer");

			f.innerHTML = showArray(likedBeers);
		}

		function showArray(arr){
			var output = "";
			for(key in arr)
			{
    			// output += "(" + arr[key].id + ") " + arr[key].beer + " | ";
    			output += arr[key].beer + " | ";         
			}
			return output;
		}

		function insert(arr, id, beer) {
    		arr.push({
        		id: id,
        		beer: beer
    		});        
		}


		//functions needed for loading the webpage
		window.onload = function() {

			beerID = 1;
			getData();

			a = document.getElementById("dislike");
			b = document.getElementById("like");
			c = document.getElementById("compare");
			d = document.getElementById("liked");

			a.onclick = function() { nextBeer(); }
			b.onclick = function() 
			{ 
				addCurrBeer();
				nextBeer(); 
			}

		}

	</script>
</head>


<!-- <body onload="getData()"> -->
<body>

	<header id="header">
		<h1>Beer Brewing Buddies</h1>
	</header>

	<form>
		<input type="button" id="dislike" value="Dislike">
		<input type="button" id="like" value="Like">
		<input type="button" id="compare" value="Compare with Friends">
		<input type="button" id="liked" value="See Liked Recipies">
	</form>

	<ul id="data">Loading...</ul>

	<footer id="footer">
		<ul id="likedBeers">&nbsp;</ul>
	<footer>

</body>
</html>

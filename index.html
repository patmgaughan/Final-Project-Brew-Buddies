<!doctype html>
<html>
<head>
	<title>API Fun</title>
	<meta charset="utf-8"/>
	<link rel="stylesheet" type="text/css" href="BrewBuddies.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
	<!-- <Files “*.json”> Header set Access-Control-Allow-Origin “*” </Files>  -->
	<script>

		//Global Variables
		var username;
		var beerID;
		var currBeer;
		var currBeerJSON;
		var likedBeers = [];
		var likedBeersJSON = [];

		//Requests and Gets the API
		//Sends the JSON file to be sorted
		function getData(num) {

			/* Step 1: Make instance of request object...
			...to make HTTP request after page is loaded*/
			request = new XMLHttpRequest();
			console.log("1 - request object created");
 
			// Step 2: Set the URL for the AJAX request to be the JSON file

			var url = "https://api.punkapi.com/v2/beers/" + beerID.toString();
 
			request.open("GET", url, true)
			console.log("2 - opened request file");
 
			// Step 3: set up event handler/callback

			request.onreadystatechange = function() {
				console.log("3 - readystatechange event fired.");
 
				if (request.readyState == 4 && request.status == 200) {

					// Step 5: wait for done + success
					console.log("5 - response received");

					result = request.responseText;
					currBeer = result;

					data = JSON.parse(result);
					currBeerJSON = data;

					showFullJson();

					
				}
				else if (request.readyState == 4 && request.status != 200) {

					document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";

				}

				else if (request.readyState == 3) {

					document.getElementById("data").innerHTML = "Too soon!  Try again";

				}

			}
		// Step 4: fire off the HTTP request
			request.send();
			console.log("4 - Request sent");
		}

		//FIX: not sure if this is or isnt working
		function getDataAsString(num) {

			alert("in function");
			/* Step 1: Make instance of request object...
			...to make HTTP request after page is loaded*/
			request = new XMLHttpRequest();
			console.log("1 - request object created");
 
			// Step 2: Set the URL for the AJAX request to be the JSON file

			var url = "https://api.punkapi.com/v2/beers/" + num;
 
			request.open("GET", url, true)
			console.log("2 - opened request file");
 
			// Step 3: set up event handler/callback

			request.onreadystatechange = function() {
				console.log("3 - readystatechange event fired.");
 
				if (request.readyState == 4 && request.status == 200) {

					// Step 5: wait for done + success
					console.log("5 - response received");

					result = request.responseText;
					alert(result);
					//currBeer = result;

					data = JSON.parse(result);
					//currBeerJSON = data;

					//return data;
					return result;

					
				}
				else if (request.readyState == 4 && request.status != 200) {

					return "Something is wrong!  Check the logs to see where this went off the rails";

				}

				else if (request.readyState == 3) {

					return "Too soon!  Try again";

				}

			}
		// Step 4: fire off the HTTP request
			request.send();
			console.log("4 - Request sent");
		}

		function showFullJson() {
			a = document.getElementById("data");
			showBeer(currBeerJSON[0], a);
		}

		function showBeer(beer, a){

			a.innerHTML = "";

			a.innerHTML += "<h2>" + beer["name"] +"<h2>";
			a.innerHTML += "<br>";
			a.innerHTML += "<img src='" + beer["image_url"] + "' height=300 />";
			a.innerHTML += "<p>" + beer["description"] + "<p>";

			a.innerHTML += "<br><br><br>"

			//a.innerHTML += "<h2>" + beer["id"] +"<h2>";
		}

		function showBeerJSON(beer){

			output = "";

			output += "<h2>" + beer["name"] +"<h2>";
			output += "<br>";
			output += "<img src='" + beer["image_url"] + "' height=300 />";
			output += "<p>" + beer["description"] + "<p>";

			return output;

		}

		function nextBeer() {
			//alert("show next beer");
			beerID++;
			getData();
		}

		function addCurrBeer() {

			insert(likedBeers, currBeerJSON[0]["id"], currBeerJSON[0]["name"]);
			likedBeersJSON.push(currBeerJSON[0]);
			f = document.getElementById("likedBeersArr");

			f.innerHTML = showArray(likedBeers);
		}

		function showArray(arr){
			var output = "";
			for(key in arr)
			{
    			// output += "(" + arr[key].id + ") " + arr[key].beer + " | ";
    			output += arr[key].beer + " | ";         
			}
			return output;
		}

		function insert(arr, id, beer) {
    		arr.push({
        		id: id,
        		beer: beer
    		});        
		}

		//TODO!!
		function compareBeer(){

			var username2 = prompt("Please Your Friend's Username", "user0001");

			var arr = prompt("Enter Friend's Beers they like", "1,3,4,5").split(",");

			alert(arr);

			var commonBeers = [];

			for(key in likedBeers)
			{
    			// output += "(" + arr[key].id + ") " + arr[key].beer + " | ";
    			alert(likedBeers[key].id);
    			//var thisID = (likedBeers[key].id).parseInt();
				if(arr.includes(thisID)){
					alert("adding beer");
					//insert(commonBeers, likedBeers[key].id, likedBeers[key].beer);
					commonBeers.push(likedBeers[key].name);
				}       
			}

			alert(commonBeers);

		}

		function showLiked(){

			$("#back").show();

			$("#dislike").hide();
			$("#like").hide();

			a = document.getElementById("data");
			a.innerHTML = "";

			if(likedBeers.length == 0){
				a.innerHTML += "No Liked Beers";
			}else{
				a.innerHTML += "<ul>";

				for(i = 0; i < likedBeersJSON.length; i++)
				{
					a.innerHTML += "<li>" + showBeerJSON(likedBeersJSON[i]) + "</li>";
				}
				a.innerHTML += "</ul>";
				a.innerHTML += "<br><br><br>";
			}
		}

		function backToSwiping(){


			$("#back").hide();

			$("#dislike").show();
			$("#like").show();

			getData();
		}


		//functions needed for loading the webpage
		window.onload = function() {

			$("#back").hide();

			//beerID = 1;
			var username = prompt("Please Your Username", "user0000");

			x = document.getElementById("username");

			x.innerHTML = "<h2>" + username + "</h2>";


			beerID = prompt("Please enter user's currBeerID", 1);

			//TODO
			FIXlikedBeers = prompt("Please enter current liked Beers", "1 2 6 8 9");
			//TODO

			getData();

			a = document.getElementById("dislike");
			b = document.getElementById("like");
			c = document.getElementById("compare");
			d = document.getElementById("liked");
			e = document.getElementById("back");

			a.onclick = function() { nextBeer(); }
			b.onclick = function() 
			{ 
				addCurrBeer();
				nextBeer(); 
			}

			c.onclick = function() { compareBeer(); }
			d.onclick = function() { showLiked(); }

			e.onclick = function() { backToSwiping(); }

		}

	</script>
</head>

<body>

	<header id="header">
		<div id="username">&nbsp;</div>
		<h1>Beer Brewing Buddies</h1>
	</header>

	<form id="nav">
		<input type="button" id="compare" value="Compare with Friends">
		<input type="button" id="liked" value="See Liked Recipies">
	</form>

	<ul id="data">Loading...</ul>


	<footer id="footer">
		<input type="button" id="back" value="Back to Swiping">
		<input type="button" id="dislike" value="clear">
		<input type="button" id="like" value="favorite">
		<div id="likedBeersArr"></div>
	<footer>
</body>
</html>
